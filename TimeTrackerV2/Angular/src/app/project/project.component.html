<a href="/course/{{project.courseID}}" class="btn btn-primary">Back to Course</a>
<h1 class="display-1" *ngIf="project">{{project.projectName}}</h1>

<!-- Instructor Add Students, Edit, and Delete buttons -->
<div [ngSwitch]="true">
    <div *ngSwitchCase="instructor">
        <div class="btn-group">
            <a href="/add-students-project/{{project.projectID}}" class="btn btn-primary">Add Students</a>
            <a href="/edit-project/{{project.projectID}}" class="btn btn-secondary">Edit</a>
            <a href="/delete-project/{{project.projectID}}" class="btn btn-danger">Delete</a>
        </div>
    </div>
</div>

<!-- Team times section -->
<div class="container">
    <div class="row">
        <div class="col-6">
            <div *ngIf="pieChartLabels.length != 0">
                <canvas baseChart [type]="'pie'" [datasets]="pieChartDatasets" [labels]="pieChartLabels"
                    [options]="pieChartOptions" [plugins]="pieChartPlugins" [legend]="pieChartLegend">
                </canvas>
            </div>
        </div>
        <div class="col-6">
            <div class="row">
                <h3>Team Times</h3>
            </div>
            <div class="row">
                <table class="table table-light table-sm table-hover table-bordered border-dark">
                    <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Total Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let teamMate of totalTimeMap | keyvalue">
                            <td>{{teamMate.key}}</td>
                            <td>{{teamMate.value | totalTimePipe}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Current user's activity -->
    <div class="row">
        <div class="col-6">
            <div class="row">
                <div class="col-9">
                    <h3>My Activity</h3>
                </div>
                <div class="col-3">
                    <!--<button type="button" class="btn btn-primary">All Activity</button>-->
                </div>
            </div>
            <div class="row">
                <table class="table table-light table-sm table-hover table-bordered border-dark">
                    <thead>
                        <tr>
                            <th scope="col">Start Time</th>
                            <th scope="col">End Time</th>
                            <th scope="col">Total Time</th>
                            <th scope="col">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let activity of activities">
                            <td>{{activity.timeIn | date:'medium'}}</td>
                            <td>{{activity.timeOut | date:'medium'}}</td>
                            <td>{{activity.timeOut - activity.timeIn | totalTimePipe}}</td>
                            <td>{{activity.description}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-6" *ngIf="isProjectUser && project.isActive">
            <!-- Toggle button to change between auto and manual mode -->
            <div class="gap-2 d-md-flex justify-content-md-left">
                <button (click)="changeSubmitType()" class="btn btn-secondary">{{manualTimeCardEntry ? "Switch to Auto Mode" :
                    "Switch to Manual Mode"}}</button>
            </div>
            <!-- Auto time card -->
            <div class="col" *ngIf="!manualTimeCardEntry">
                <!--Date Row-->
                <div class="row, center">
                    <h3>{{currDate}}</h3>
                </div>
                <!--Time Row-->
                <div class="row, center">
                    <h1>{{hours}}:{{minutes}}:{{seconds}}</h1>
                </div>
                <!--Start/Stop Buttons-->
                <div class="gap-2 d-md-flex justify-content-md-center">
                    <button (click)="clockIn()" type="button" class="btn btn-success">Start</button>
                </div>
                <!--Submit Button-->
                <div class="gap-4 d-md-flex justify-content-md-center">
                    <form (ngSubmit)="autoSubmit()">
                        <div class="row mt-2">
                            <input type="text" placeholder="Work Description" class="form-control"
                                [formControl]="description" required>
                        </div>
                        <div class="d-grid d-md-flex justify-content-md-center">
                            <!-- If the input is not valid and the timer is not running, disable the submit button -->
                            <button type="submit" class="btn btn-primary mt-2"
                                [disabled]="!(this.description.valid && isTimerRunning)">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Manual time card -->
            <div class="col" *ngIf="manualTimeCardEntry">
                <div class="gap-4 d-md-flex justify-content-md-center">
                    <form (ngSubmit)="manualSubmit()">
                        <!-- Start time row -->
                        <div class="row mt-2">
                            <label for="timeCardStart">Start Time</label>
                            <input type="datetime-local" id="timeCardStart" class="form-control"
                                [formControl]="timecardStart" required>
                        </div>
                        <!-- End time row -->
                        <div class="row mt-2">
                            <label for="timecardEnd">Start Time</label>
                            <input type="datetime-local" id="timecardEnd" class="form-control"
                                [formControl]="timecardEnd" required>
                        </div>
                        <!-- Description row -->
                        <div class="row mt-2">
                            <input type="text" placeholder="Work Description" class="form-control"
                                [formControl]="description" required>
                        </div>
                        <div class="d-grid d-md-flex justify-content-md-center">
                            <button type="submit" class="btn btn-primary mt-2"
                                [disabled]="!(this.timecardStart.valid && this.timecardEnd.valid && this.description.valid)">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- History of project -->
    <div class="row">
        <div class="col align-self-center">
            <div class="row">
                <div class="col-10">
                    <h3>History</h3>
                </div>
                <div class="col-2">
                    <!--<button type="button" class="btn btn-primary">All History</button>-->
                </div>
            </div>
            <div class="row">
                <table class="table table-light table-sm table-hover table-bordered border-dark"
                    style="max-height: 200px; overflow-y:scroll">
                    <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Time In</th>
                            <th scope="col">Time Out</th>
                            <th scope="col">Total Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let user of projectUserTimes">
                            <td>{{user.firstName}} {{user.lastName}}</td>
                            <td>{{user.timeIn| date:'medium'}}</td>
                            <td>{{user.timeOut| date:'medium'}}</td>
                            <td>{{user.timeOut - user.timeIn | totalTimePipe}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>